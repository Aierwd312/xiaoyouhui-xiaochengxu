{"version":3,"file":"user.js","sources":["store/modules/user.js"],"sourcesContent":["import config from '@/config'\r\nimport storage from '@/utils/storage'\r\nimport constant from '@/utils/constant'\r\nimport { login, logout, getInfo } from '@/api/login'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\n\r\nconst baseUrl = config.baseUrl\r\n\r\nconst user = {\r\n  state: {\r\n    token: getToken(),\r\n    name: storage.get(constant.name),\r\n    nickName: storage.get(constant.nickName),\r\n    avatar: storage.get(constant.avatar),\r\n    roles: storage.get(constant.roles),\r\n    permissions: storage.get(constant.permissions)\r\n  },\r\n\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      state.token = token\r\n    },\r\n    SET_NAME: (state, name) => {\r\n      state.name = name\r\n      storage.set(constant.name, name)\r\n    },\r\n    SET_NICKNAME: (state, nickName) => {\r\n      state.nickName = nickName\r\n      storage.set(constant.nickName, nickName)\r\n    },\r\n    SET_AVATAR: (state, avatar) => {\r\n      state.avatar = avatar\r\n      storage.set(constant.avatar, avatar)\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles\r\n      storage.set(constant.roles, roles)\r\n    },\r\n    SET_PERMISSIONS: (state, permissions) => {\r\n      state.permissions = permissions\r\n      storage.set(constant.permissions, permissions)\r\n    }\r\n  },\r\n\r\n  actions: {\r\n    // 登录\r\n    Login({ commit }, userInfo) {\r\n      const username = userInfo.username\r\n      const password = userInfo.password\r\n      const code = userInfo.code\r\n      const uuid = userInfo.uuid\r\n      return new Promise((resolve, reject) => {\r\n        login(username, password, code, uuid).then(res => {\r\n          //setToken(res.data.access_token)\r\n          //commit('SET_TOKEN',res.data.access_token )\r\n\t\t  setToken(res.token)\r\n\t\t  commit('SET_TOKEN',res.token )\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 获取用户信息\r\n    GetInfo({ commit, state }) {\r\n      return new Promise((resolve, reject) => {\r\n        getInfo().then(res => {\r\n          const user = res.user\r\n\t\t  //const avatar = (user == null || user.avatar == \"\" || user.avatar == null) ? \"@/static/images/profile.jpg\" : baseUrl + user.avatar\r\n\t\t  /* cloud */\r\n\t\t  const avatar = (user == null || user.avatar == \"\" || user.avatar == null) ? \"/static/images/profile.jpg\" : user.avatar\r\n\t\t  const username = (user == null || user.userName == \"\" || user.userName == null) ? \"\" : user.userName\r\n\t\t  const nickName = (user == null || user.nickName == \"\" || user.nickName == null) ? \"\" : user.nickName\r\n          if (res.roles && res.roles.length > 0) {\r\n            commit('SET_ROLES', res.roles)\r\n            commit('SET_PERMISSIONS', res.permissions)\r\n          } else {\r\n            commit('SET_ROLES', ['ROLE_DEFAULT'])\r\n          }\r\n          commit('SET_NAME', username)\r\n          commit('SET_NICKNAME', nickName)\r\n          commit('SET_AVATAR', avatar)\r\n          resolve(res)\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 退出系统\r\n    LogOut({ commit, state }) {\r\n      return new Promise((resolve, reject) => {\r\n        logout(state.token).then(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_ROLES', [])\r\n          commit('SET_PERMISSIONS', [])\r\n          removeToken()\r\n          storage.clean()\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport default user\r\n"],"names":["config","getToken","storage","constant","login","setToken","getInfo","user","logout","removeToken"],"mappings":"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"}