{"version":3,"file":"alumniCardPage.js","sources":["pages/alumniCardPage/alumniCardPage.js","pages/alumniCardPage/alumniCardPage.vue","../../../../Program Files/HBuilderX.4.76.2025082103/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWx1bW5pQ2FyZFBhZ2UvYWx1bW5pQ2FyZFBhZ2UudnVl"],"sourcesContent":["import { generateQRCode, getAlumniInfo } from '@/api/alumniCard'\r\nimport { toast } from '@/utils/common'\r\nimport store from '@/store'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\t// 导航栏配置\r\n\t\t\tnavBackground: '#F0F4F8', // 导航栏背景色 - 与页面背景色保持一致\r\n\t\t\tnavTitleColor: '#004299', // 导航栏标题颜色 - 重财蓝，在浅色背景上使用深色文字\r\n\t\t\t\r\n\t\t\t// 用户信息\r\n\t\t\tuserInfo: {\r\n\t\t\t\tname: '', // 用户姓名\r\n\t\t\t\tenrollmentYear: '', // 入学年份\r\n\t\t\t\teducationType: '', // 入学类型：本科、专升本等\r\n\t\t\t\tfaculty: '', // 院系\r\n\t\t\t\tavatar: '', // 头像URL，为空则使用默认头像\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 二维码数据\r\n\t\t\tqrcodeValue: '', // 二维码内容\r\n\t\t\tqrcodeExpireTime: 0, // 二维码过期时间戳\r\n\t\t\tqrcodeRefreshTimer: null, // 二维码刷新定时器\r\n\t\t\t\r\n\t\t\t// 是否显示二维码\r\n\t\t\tshowQRCode: false,\r\n\t\t\t\r\n\t\t\t// 加载状态\r\n\t\t\tloading: false,\r\n\t\t\t\r\n\t\t\t// 测试模式 - 用于调试，实际部署时应设为false\r\n\t\t\ttestMode: true\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\t\t// 页面加载时获取用户信息和生成二维码\r\n\t\tthis.loadUserInfo();\r\n\t},\r\n\tonUnload() {\r\n\t\t// 页面卸载时清除定时器\r\n\t\tif (this.qrcodeRefreshTimer) {\r\n\t\t\tclearTimeout(this.qrcodeRefreshTimer);\r\n\t\t}\r\n\t\tif (this.expirationTimer) {\r\n\t\t\tclearTimeout(this.expirationTimer);\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t/**\r\n\t\t * 返回上一页\r\n\t\t */\r\n\t\tgoBack() {\r\n\t\t\tuni.navigateBack({\r\n\t\t\t\tdelta: 1\r\n\t\t\t});\r\n\t\t},\r\n\t\r\n\t\t/**\r\n\t\t * 加载用户信息\r\n\t\t */\r\n\t\tasync loadUserInfo() {\r\n\t\t\tlet loadingShown = false;\r\n\t\t\ttry {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '加载中...'\r\n\t\t\t\t});\r\n\t\t\t\tloadingShown = true;\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('开始获取用户校友信息...');\r\n\t\t\t\t\r\n\t\t\t\t// 测试模式：使用模拟数据\r\n\t\t\t\tif (this.testMode) {\r\n\t\t\t\t\tconsole.log('测试模式：使用模拟用户信息');\r\n\t\t\t\t\t// 从store获取昵称\r\n\t\t\t\t\tconst nickName = store.state.user.nickName || '校友';\r\n\t\t\t\t\tconst mockUserInfo = {\r\n\t\t\t\t\t\tcode: 200,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tenrollmentYear: '2020',\r\n\t\t\t\t\t\t\teducationType: '本科',\r\n\t\t\t\t\t\t\tfaculty: '计算机学院',\r\n\t\t\t\t\t\t\tavatar: ''\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmsg: '获取成功'\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 模拟网络延迟\r\n\t\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 500));\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log('模拟用户信息响应:', mockUserInfo);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (mockUserInfo.code === 200 && mockUserInfo.data) {\r\n\t\t\t\t\t\tthis.userInfo = {\r\n\t\t\t\t\t\t\tname: nickName,\r\n\t\t\t\t\t\t\tenrollmentYear: mockUserInfo.data.enrollmentYear || '',\r\n\t\t\t\t\t\t\teducationType: mockUserInfo.data.educationType || '',\r\n\t\t\t\t\t\t\tfaculty: mockUserInfo.data.faculty || '',\r\n\t\t\t\t\t\t\tavatar: mockUserInfo.data.avatar || ''\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tconsole.log('用户信息加载成功:', this.userInfo);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 从store获取昵称\r\n\t\t\t\tconst nickName = store.state.user.nickName || '校友';\r\n\t\t\t\t\r\n\t\t\t\t// 获取用户校友信息\r\n\t\t\t\tconst userInfoRes = await getAlumniInfo();\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('用户信息API响应:', userInfoRes);\r\n\t\t\t\t\r\n\t\t\t\tif (userInfoRes && userInfoRes.code === 200 && userInfoRes.data) {\r\n\t\t\t\t\tthis.userInfo = {\r\n\t\t\t\t\t\tname: nickName,\r\n\t\t\t\t\t\tenrollmentYear: userInfoRes.data.enrollmentYear || '',\r\n\t\t\t\t\t\teducationType: userInfoRes.data.educationType || '',\r\n\t\t\t\t\t\tfaculty: userInfoRes.data.faculty || '',\r\n\t\t\t\t\t\tavatar: userInfoRes.data.avatar || ''\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconsole.log('用户信息加载成功:', this.userInfo);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('用户信息API返回异常，使用默认值');\r\n\t\t\t\t\t// 如果获取用户信息失败，使用默认值\r\n\t\t\t\t\tthis.userInfo = {\r\n\t\t\t\t\t\tname: nickName,\r\n\t\t\t\t\t\tenrollmentYear: '未知',\r\n\t\t\t\t\t\teducationType: '未知',\r\n\t\t\t\t\t\tfaculty: '未知',\r\n\t\t\t\t\t\tavatar: ''\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('获取用户信息失败:', error);\r\n\t\t\t\t// 从store获取昵称作为默认值\r\n\t\t\t\tconst nickName = store.state.user.nickName || '校友';\r\n\t\t\t\t// 如果获取用户信息失败，使用默认值\r\n\t\t\t\tthis.userInfo = {\r\n\t\t\t\t\tname: nickName,\r\n\t\t\t\t\tenrollmentYear: '未知',\r\n\t\t\t\t\teducationType: '未知',\r\n\t\t\t\t\tfaculty: '未知',\r\n\t\t\t\t\tavatar: ''\r\n\t\t\t\t};\r\n\t\t\t} finally {\r\n\t\t\t\tif (loadingShown) {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 生成二维码\r\n\t\t */\r\n\t\tasync generateQRCode() {\r\n\t\t\tif (this.loading) return;\r\n\t\t\t\r\n\t\t\tthis.loading = true;\r\n\t\t\tlet loadingShown = false;\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '生成二维码中...'\r\n\t\t\t\t});\r\n\t\t\t\tloadingShown = true;\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('开始调用二维码生成API...');\r\n\t\t\t\t\r\n\t\t\t\t// 测试模式：使用模拟数据\r\n\t\t\t\tif (this.testMode) {\r\n\t\t\t\t\tconsole.log('测试模式：使用模拟二维码数据');\r\n\t\t\t\t\tconst mockResponse = {\r\n\t\t\t\t\t\tcode: 200,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tqrcode: `ALUMNI_CARD_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmsg: '生成成功'\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 模拟网络延迟\r\n\t\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000));\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log('模拟API响应:', mockResponse);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (mockResponse.code === 200 && mockResponse.data && mockResponse.data.qrcode) {\r\n\t\t\t\t\t\tthis.qrcodeValue = mockResponse.data.qrcode;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 设置过期时间（30分钟）\r\n\t\t\t\t\t\tconst expireTime = Date.now() + 30 * 60 * 1000;\r\n\t\t\t\t\t\tthis.qrcodeExpireTime = expireTime;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 设置定时器，接近过期时提醒用户刷新\r\n\t\t\t\t\t\tthis.setExpirationReminder();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 设置自动刷新定时器（25分钟后自动刷新）\r\n\t\t\t\t\t\tthis.setAutoRefresh();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('二维码生成成功:', this.qrcodeValue);\r\n\t\t\t\t\t\ttoast('二维码生成成功');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 调用后端API生成二维码\r\n\t\t\t\tconst response = await generateQRCode();\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('API响应:', response);\r\n\t\t\t\t\r\n\t\t\t\t// 检查响应是否是HTML页面（RuoYi欢迎页面）\r\n\t\t\t\tif (typeof response === 'string' && response.includes('RuoYi')) {\r\n\t\t\t\t\tthrow new Error('API返回了欢迎页面，请检查API地址和端口配置');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (response && response.code === 200) {\r\n\t\t\t\t\t// 处理不同的响应数据结构\r\n\t\t\t\t\tlet qrcodeData = '';\r\n\t\t\t\t\tif (response.data) {\r\n\t\t\t\t\t\tqrcodeData = response.data.qrcode || response.data.qrcodeValue || response.data;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tqrcodeData = response.qrcode || response.qrcodeValue || '';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (qrcodeData && typeof qrcodeData === 'string') {\r\n\t\t\t\t\t\tthis.qrcodeValue = qrcodeData;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 设置过期时间（30分钟）\r\n\t\t\t\t\t\tconst expireTime = Date.now() + 30 * 60 * 1000;\r\n\t\t\t\t\t\tthis.qrcodeExpireTime = expireTime;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 设置定时器，接近过期时提醒用户刷新\r\n\t\t\t\t\t\tthis.setExpirationReminder();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 设置自动刷新定时器（25分钟后自动刷新）\r\n\t\t\t\t\t\tthis.setAutoRefresh();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('二维码生成成功:', qrcodeData);\r\n\t\t\t\t\t\ttoast('二维码生成成功');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('服务器返回的二维码数据格式不正确');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst errorMsg = response ? (response.msg || response.message || '生成二维码失败') : '服务器无响应';\r\n\t\t\t\t\tthrow new Error(errorMsg);\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('生成二维码失败:', error);\r\n\t\t\t\t\r\n\t\t\t\t// 提供更详细的错误信息\r\n\t\t\t\tlet errorMessage = '生成二维码失败';\r\n\t\t\t\tif (error.message) {\r\n\t\t\t\t\tif (error.message.includes('timeout')) {\r\n\t\t\t\t\t\terrorMessage = '请求超时，请检查网络连接';\r\n\t\t\t\t\t} else if (error.message.includes('Network Error')) {\r\n\t\t\t\t\t\terrorMessage = '网络连接失败，请检查网络设置';\r\n\t\t\t\t\t} else if (error.message.includes('500')) {\r\n\t\t\t\t\t\terrorMessage = '服务器内部错误，请稍后重试';\r\n\t\t\t\t\t} else if (error.message.includes('401')) {\r\n\t\t\t\t\t\terrorMessage = '身份验证失败，请重新登录';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\terrorMessage = error.message;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttoast(errorMessage);\r\n\t\t\t\t\r\n\t\t\t\t// 清空二维码值，显示错误状态\r\n\t\t\t\tthis.qrcodeValue = '';\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t\tif (loadingShown) {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 设置过期提醒\r\n\t\t */\r\n\t\tsetExpirationReminder() {\r\n\t\t\t// 清除之前的计时器\r\n\t\t\tif (this.expirationTimer) {\r\n\t\t\t\tclearTimeout(this.expirationTimer);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst now = Date.now();\r\n\t\t\tconst timeToExpire = this.qrcodeExpireTime - now;\r\n\t\t\t\r\n\t\t\t// 如果已过期，立即刷新\r\n\t\t\tif (timeToExpire <= 0) {\r\n\t\t\t\tthis.generateQRCode();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 设置在二维码过期前5分钟提醒\r\n\t\t\tconst reminderTime = timeToExpire - (5 * 60 * 1000);\r\n\t\t\tif (reminderTime > 0) {\r\n\t\t\t\tthis.expirationTimer = setTimeout(() => {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '二维码即将过期，请刷新',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 3000\r\n\t\t\t\t\t});\r\n\t\t\t\t}, reminderTime);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 设置自动刷新\r\n\t\t */\r\n\t\tsetAutoRefresh() {\r\n\t\t\t// 清除之前的自动刷新定时器\r\n\t\t\tif (this.qrcodeRefreshTimer) {\r\n\t\t\t\tclearTimeout(this.qrcodeRefreshTimer);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 25分钟后自动刷新二维码\r\n\t\t\tthis.qrcodeRefreshTimer = setTimeout(() => {\r\n\t\t\t\tif (this.showQRCode) {\r\n\t\t\t\t\tthis.generateQRCode();\r\n\t\t\t\t}\r\n\t\t\t}, 25 * 60 * 1000);\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 切换二维码显示/隐藏\r\n\t\t */\r\n\t\ttoggleQRCode() {\r\n\t\t\tif (!this.showQRCode) {\r\n\t\t\t\t// 显示前刷新二维码\r\n\t\t\t\tthis.generateQRCode();\r\n\t\t\t}\r\n\t\t\tthis.showQRCode = !this.showQRCode;\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 切换测试模式\r\n\t\t */\r\n\t\ttoggleTestMode() {\r\n\t\t\tthis.testMode = !this.testMode;\r\n\t\t\ttoast(`测试模式已${this.testMode ? '开启' : '关闭'}`);\r\n\t\t\tconsole.log('测试模式:', this.testMode ? '开启' : '关闭');\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 测试API连接\r\n\t\t */\r\n\t\tasync testAPIConnection() {\r\n\t\t\ttry {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '测试API连接...'\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('开始测试API连接...');\r\n\t\t\t\tconsole.log('API地址: http://10.155.10.148:8082/core/studentInfo/QRCode');\r\n\t\t\t\t\r\n\t\t\t\t// 直接调用API进行测试\r\n\t\t\t\tconst response = await generateQRCode();\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('API测试响应:', response);\r\n\t\t\t\t\r\n\t\t\t\tif (response) {\r\n\t\t\t\t\tif (typeof response === 'string') {\r\n\t\t\t\t\t\tif (response.includes('RuoYi')) {\r\n\t\t\t\t\t\t\ttoast('API返回了RuoYi欢迎页面，请检查API路径');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoast('API返回了字符串数据');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (response.code === 200) {\r\n\t\t\t\t\t\ttoast('API连接成功！');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttoast(`API返回错误码: ${response.code}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast('API无响应');\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('API测试失败:', error);\r\n\t\t\t\ttoast(`API测试失败: ${error.message}`);\r\n\t\t\t} finally {\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","<template>\n\t<view class=\"content-area\">\n\t\t<!-- 使用FirstUI导航栏组件 -->\n\t\t<fui-nav-bar\n\t\t\t:statusBar=\"true\"\n\t\t\ttitle=\"校友卡\"\n\t\t\t:background=\"navBackground\"\n\t\t\t:color=\"navTitleColor\"\n\t\t\t:size=\"18\"\n\t\t\t:isFixed=\"true\"\n\t\t\t:fontWeight=\"500\"\n\t\t\t@init=\"navbarInit\"\n\t\t\t@leftClick=\"goBack\"\n\t\t\t@longpress=\"toggleTestMode\">\n\t\t\t<!-- 根据文档，左侧内容通过默认插槽实现 -->\n\t\t\t<fui-icon name=\"arrowleft\" :size=\"48\" :color=\"navTitleColor\"></fui-icon>\n\t\t</fui-nav-bar>\n\t\t\n\t\t<!-- 卡片主体内容 -->\n\t\t<view class=\"card-container\" :style=\"{ marginTop: navHeight + 'px' }\">\n\t\t\t<!-- 校友卡信息卡片 -->\n\t\t\t<view class=\"alumni-card\">\n\t\t\t\t<!-- 卡片顶部校徽和校名 -->\n\t\t\t\t<view class=\"card-header\">\n\t\t\t\t\t<view class=\"school-title-image\">\n\t\t\t\t\t\t<image src=\"/static/school-badge- belt.png\" class=\"title-full-image\"></image>\n\t\t\t\t\t\t<!-- <text class=\"school-alumni-text\">校友卡</text> -->\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 卡片内容区域 -->\n\t\t\t\t<view class=\"card-content\">\n\t\t\t\t\t<!-- 左侧信息区 -->\n\t\t\t\t\t<view class=\"user-info\">\n\t\t\t\t\t\t<fui-row margin-bottom=\"16rpx\">\n\t\t\t\t\t\t\t<fui-col :span=\"8\">\n\t\t\t\t\t\t\t\t<view class=\"label-container\">\n\t\t\t\t\t\t\t\t\t<text class=\"info-label\">姓名</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t\t<fui-col :span=\"16\">\n\t\t\t\t\t\t\t\t<text class=\"info-value\">{{ userInfo.name }}</text>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t</fui-row>\n\t\t\t\t\t\t<fui-row margin-bottom=\"16rpx\">\n\t\t\t\t\t\t\t<fui-col :span=\"8\">\n\t\t\t\t\t\t\t\t<view class=\"label-container\">\n\t\t\t\t\t\t\t\t\t<text class=\"info-label\">入校年份</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t\t<fui-col :span=\"16\">\n\t\t\t\t\t\t\t\t<text class=\"info-value\">{{ userInfo.enrollmentYear }}</text>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t</fui-row>\n\t\t\t\t\t\t<fui-row margin-bottom=\"16rpx\">\n\t\t\t\t\t\t\t<fui-col :span=\"8\">\n\t\t\t\t\t\t\t\t<view class=\"label-container\">\n\t\t\t\t\t\t\t\t\t<text class=\"info-label\">入校类型</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t\t<fui-col :span=\"16\">\n\t\t\t\t\t\t\t\t<text class=\"info-value\">{{ userInfo.educationType }}</text>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t</fui-row>\n\t\t\t\t\t\t<fui-row>\n\t\t\t\t\t\t\t<fui-col :span=\"8\">\n\t\t\t\t\t\t\t\t<view class=\"label-container\">\n\t\t\t\t\t\t\t\t\t<text class=\"info-label\">院系</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t\t<fui-col :span=\"16\">\n\t\t\t\t\t\t\t\t<text class=\"info-value\">{{ userInfo.faculty }}</text>\n\t\t\t\t\t\t\t</fui-col>\n\t\t\t\t\t\t</fui-row>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 右侧照片区 -->\n\t\t\t\t\t<view class=\"user-photo\">\n\t\t\t\t\t\t<image :src=\"userInfo.avatar || '/static/user-fill.svg'\" class=\"photo-image\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 内嵌二维码区域 -->\n\t\t\t<view class=\"qrcode-area\" v-if=\"showQRCode\">\n\t\t\t\t<view class=\"inline-qrcode-container\">\n\t\t\t\t\t<view class=\"qrcode-title-area\">\n\t\t\t\t\t\t<text class=\"qrcode-title\">校友身份二维码</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"qrcode-content\">\n\t\t\t\t\t\t<view v-if=\"loading\" class=\"qrcode-loading\">\n\t\t\t\t\t\t\t<uni-load-more status=\"loading\" :content-text=\"{contentdown: '生成中...', contentrefresh: '生成中...', contentnomore: '生成中...'}\"></uni-load-more>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<fui-qrcode \n\t\t\t\t\t\t\tv-else-if=\"qrcodeValue\"\n\t\t\t\t\t\t\t:value=\"qrcodeValue\" \n\t\t\t\t\t\t\t:width=\"240\" \n\t\t\t\t\t\t\t:height=\"240\"\n\t\t\t\t\t\t\tforeground=\"#004299\"\n\t\t\t\t\t\t\tbackground=\"#ffffff\"\n\t\t\t\t\t\t\t@ready=\"onQRCodeReady\">\n\t\t\t\t\t\t</fui-qrcode>\n\t\t\t\t\t\t<view v-else class=\"qrcode-error\">\n\t\t\t\t\t\t\t<text class=\"error-text\">二维码生成失败</text>\n\t\t\t\t\t\t\t<view class=\"refresh-btn\" @tap=\"generateQRCode\">\n\t\t\t\t\t\t\t\t<text class=\"refresh-text\">重新生成</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"qrcode-footer\">\n\t\t\t\t\t\t<text class=\"qrcode-desc\">扫码验证校友身份</text>\n\t\t\t\t\t\t<text class=\"qrcode-tip\">二维码有效期30分钟，请勿外传</text>\n\t\t\t\t\t\t<view class=\"qrcode-actions\">\n\t\t\t\t\t\t\t<view class=\"refresh-qrcode-btn\" @tap=\"generateQRCode\" :class=\"{disabled: loading}\">\n\t\t\t\t\t\t\t\t<image src=\"/static/refresh-line.svg\" class=\"refresh-icon\"></image>\n\t\t\t\t\t\t\t\t<text class=\"refresh-btn-text\">{{ loading ? '生成中...' : '刷新' }}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 调试按钮区域 -->\n\t\t<view class=\"debug-buttons\" v-if=\"testMode\">\n\t\t\t<view class=\"debug-btn\" @tap=\"testAPIConnection\">\n\t\t\t\t<text class=\"debug-btn-text\">测试API</text>\n\t\t\t</view>\n\t\t\t<view class=\"debug-btn\" @tap=\"toggleTestMode\">\n\t\t\t\t<text class=\"debug-btn-text\">关闭测试</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 底部固定按钮 -->\n\t\t<view class=\"bottom-button\" @tap=\"toggleQRCode\">\n\t\t\t<view class=\"button-content\">\n\t\t\t\t<image src=\"/static/qr-code-line.svg\" class=\"qrcode-icon\"></image>\n\t\t\t\t<text class=\"button-text\">二维码</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 测试模式开关（长按导航栏标题激活） -->\n\t\t<view class=\"test-mode-indicator\" v-if=\"testMode\">\n\t\t\t<text class=\"test-mode-text\">测试模式</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport alumniCardPageJs from './alumniCardPage.js'\n\timport { ref, computed, onMounted } from 'vue';\n\t// import fuiQrcode from '@/components/firstui/fui-qrcode/fui-qrcode.vue'; // 使用easycom后，不再需要手动引入\n\t\n\texport default {\n\t\tcomponents: {\n\t\t\t// fuiQrcode // 使用easycom后，不再需要手动注册\n\t\t},\n\t\t...alumniCardPageJs,\n\t\tsetup() {\n\t\t\t// 导航栏高度\n\t\t\tconst navHeight = ref(44);\n\t\t\tconst statusBarHeight = ref(0);\n\t\t\t\n\t\t\t// 初始化导航栏\n\t\t\tconst navbarInit = (e) => {\n\t\t\t\tstatusBarHeight.value = e.statusBarHeight;\n\t\t\t\tnavHeight.value = e.height + e.statusBarHeight;\n\t\t\t}\n\t\t\t\n\t\t\treturn {\n\t\t\t\tnavHeight,\n\t\t\t\tstatusBarHeight,\n\t\t\t\tnavbarInit\n\t\t\t};\n\t\t},\n\t\tmethods: {\n\t\t\t...alumniCardPageJs.methods,\n\t\t\tonQRCodeReady(e) {\n\t\t\t\tconsole.log('QR Code ready:', e);\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t@import './alumniCardPage.css';\n</style>\n","import MiniProgramPage from 'D:/Projects/XBuider/校友会/xiaoyouhui-xiaochengxu/pages/alumniCardPage/alumniCardPage.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","nickName","store","getAlumniInfo","toast","generateQRCode","ref"],"mappings":"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"}