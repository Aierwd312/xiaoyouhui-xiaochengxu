{"version":3,"file":"fui-qrcode.js","sources":["components/firstui/fui-qrcode/fui-qrcode.vue","../../../../Program Files/HBuilderX.4.76.2025082103/plugins/uniapp-cli-vite/uniComponent:/RDovUHJvamVjdHMvWEJ1aWRlci_moKHlj4vkvJoveGlhb3lvdWh1aS14aWFvY2hlbmd4dS9jb21wb25lbnRzL2ZpcnN0dWkvZnVpLXFyY29kZS9mdWktcXJjb2RlLnZ1ZQ"],"sourcesContent":["<template>\r\n\r\n\t<!-- #ifdef APP-NVUE -->\r\n\t<gcanvas @longpress=\"longtap\" @touchstart=\"touchstart\" @touchend=\"touchend\" :ref=\"canvasId\"\r\n\t\t:style=\"{ width: w + 'px', height:h + 'px'  }\">\r\n\t</gcanvas>\r\n\t<!-- #endif -->\r\n\r\n\t<!-- #ifdef MP-QQ -->\r\n\t<canvas canvas-id=\"canvas_qrcode\" :style=\"{width:w+'px',height:h+'px'}\" @longtap=\"longtap\" @touchstart=\"touchstart\"\r\n\t\t@touchend=\"touchend\"></canvas>\r\n\t<!-- #endif -->\r\n\r\n\t<!-- #ifdef MP-WEIXIN -->\r\n\t<canvas type=\"2d\" :canvas-id=\"canvasId\" :id=\"canvasId\" :style=\"{width:w+'px',height:h+'px'}\" @longtap=\"longtap\"\r\n\t\t@touchstart=\"touchstart\" @touchend=\"touchend\" v-if=\"canvasId\"></canvas>\r\n\t<!-- #endif -->\r\n\r\n\t<!-- #ifndef APP-NVUE || MP-QQ || MP-WEIXIN-->\r\n\t<canvas :canvas-id=\"canvasId\" :id=\"canvasId\" :style=\"{width:w+'px',height:h+'px'}\" @longtap=\"longtap\"\r\n\t\t@touchstart=\"touchstart\" @touchend=\"touchend\" v-if=\"canvasId\"></canvas>\r\n\t<!-- #endif -->\r\n\r\n</template>\r\n\r\n<script>\r\n\timport fuiQr from './fui-qr/index.js'\r\n\r\n\t// #ifdef APP-NVUE\r\n\timport {\r\n\t\tenable,\r\n\t\tWeexBridge\r\n\t} from './gcanvas/index.js';\r\n\t// #endif\r\n\r\n\tconst utf16to8 = (str) => {\r\n\t\tconst len = str.length\r\n\t\tlet out = ''\r\n\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tconst c = str.charCodeAt(i)\r\n\r\n\t\t\tif ((c >= 0x0001) && (c <= 0x007F)) {\r\n\t\t\t\tout += str.charAt(i)\r\n\t\t\t} else if (c > 0x07FF) {\r\n\t\t\t\tout += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F))\r\n\t\t\t\tout += String.fromCharCode(0x80 | ((c >> 6) & 0x3F))\r\n\t\t\t\tout += String.fromCharCode(0x80 | ((c >> 0) & 0x3F))\r\n\t\t\t} else {\r\n\t\t\t\tout += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F))\r\n\t\t\t\tout += String.fromCharCode(0x80 | ((c >> 0) & 0x3F))\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn out\r\n\t}\r\n\t// #ifdef MP-WEIXIN\r\n\tconst canvasId = `fui_qr_${Math.ceil(Math.random() * 10e5).toString(36)}`\r\n\t// #endif\r\n\r\n\t// #ifdef MP-QQ\r\n\tconst canvasId = 'canvas_qrcode'\r\n\t// #endif\r\n\texport default {\r\n\t\tname: \"fui-qrcode\",\r\n\t\temits: ['ready', 'longclick', 'touchStart', 'touchEnd'],\r\n\t\tprops: {\r\n\t\t\twidth: {\r\n\t\t\t\ttype: [Number, String],\r\n\t\t\t\tdefault: 400\r\n\t\t\t},\r\n\t\t\theight: {\r\n\t\t\t\ttype: [Number, String],\r\n\t\t\t\tdefault: 400\r\n\t\t\t},\r\n\t\t\tvalue: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tforeground: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '#181818'\r\n\t\t\t},\r\n\t\t\tbackground: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '#ffffff'\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\t// #ifndef MP-WEIXIN || MP-QQ\r\n\t\t\tconst canvasId = `fui_qr_${Math.ceil(Math.random() * 10e5).toString(36)}`\r\n\t\t\t// #endif\r\n\t\t\treturn {\r\n\t\t\t\tcanvasId,\r\n\t\t\t\t//误差校正等级\r\n\t\t\t\terrorCorrectLevel: 2,\r\n\t\t\t\t//类型\r\n\t\t\t\ttypeNumber: -1,\r\n\t\t\t\tw: 200,\r\n\t\t\t\th: 200\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tinitDraw() {\r\n\t\t\t\treturn `${this.width}_${this.height}_${this.foreground}_${this.background}_${this.value}`\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tinitDraw(val) {\r\n\t\t\t\tthis.w = uni.upx2px(this.width || 400)\r\n\t\t\t\tthis.h = uni.upx2px(this.height || 400)\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.draw()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.w = uni.upx2px(this.width || 400)\r\n\t\t\tthis.h = uni.upx2px(this.height || 400)\r\n\t\t\tthis.ctx = null;\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.draw()\r\n\t\t\t\t\tthis.$emit('ready', {\r\n\t\t\t\t\t\tcanvasId: this.canvasId\r\n\t\t\t\t\t})\r\n\t\t\t\t}, 50)\r\n\t\t\t})\r\n\t\t},\r\n\t\t// #ifndef VUE3\r\n\t\tbeforeDestroy() {\r\n\t\t\tthis.ctx = null;\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifdef VUE3\r\n\t\tbeforeUnmount() {\r\n\t\t\tthis.ctx = null;\r\n\t\t},\r\n\t\t// #endif\r\n\t\tmethods: {\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\tgetContext(callback) {\r\n\t\t\t\tconst query = uni.createSelectorQuery().in(this)\r\n\t\t\t\tquery.select(`#${this.canvasId}`)\r\n\t\t\t\t\t.fields({\r\n\t\t\t\t\t\tnode: true,\r\n\t\t\t\t\t\tsize: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec((res) => {\r\n\t\t\t\t\t\tconst canvas = res[0].node\r\n\t\t\t\t\t\tconst ctx = canvas.getContext('2d')\r\n\t\t\t\t\t\tconst dpr = uni.getSystemInfoSync().pixelRatio\r\n\t\t\t\t\t\tcanvas.width = res[0].width * dpr\r\n\t\t\t\t\t\tcanvas.height = res[0].height * dpr\r\n\t\t\t\t\t\tctx.scale(dpr, dpr)\r\n\t\t\t\t\t\tthis.ctx = ctx;\r\n\t\t\t\t\t\tcallback && callback()\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\tdrawQrcode() {\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tthis.ctx.clearRect(0, 0, this.w, this.h);\r\n\t\t\t\t// #endif\r\n\t\t\t\tconst qrcode = fuiQr(utf16to8(this.value), {\r\n\t\t\t\t\ttypeNumber: this.typeNumber,\r\n\t\t\t\t\terrorCorrectLevel: this.errorCorrectLevel,\r\n\t\t\t\t})\r\n\t\t\t\tconst cells = qrcode.modules\r\n\t\t\t\tconst tileW = this.w / cells.length\r\n\t\t\t\tconst tileH = this.h / cells.length\r\n\r\n\t\t\t\tif (!this.ctx) {\r\n\t\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\t\tlet ganvas = this.$refs[this.canvasId];\r\n\t\t\t\t\t/*通过元素引用获取canvas对象*/\r\n\t\t\t\t\tlet canvasObj = enable(ganvas, {\r\n\t\t\t\t\t\tbridge: WeexBridge\r\n\t\t\t\t\t});\r\n\t\t\t\t\t/*获取绘图所需的上下文，暂不支持3d*/\r\n\t\t\t\t\tthis.ctx = canvasObj.getContext('2d');\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t\t// #ifndef APP-NVUE || MP-WEIXIN\r\n\t\t\t\t\tthis.ctx = uni.createCanvasContext(this.canvasId, this)\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\tthis.ctx.scale(1, 1)\r\n\t\t\t\t// #endif\r\n\t\t\t\tcells.forEach((row, rdx) => {\r\n\t\t\t\t\trow.forEach((cell, cdx) => {\r\n\t\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\t\t\tthis.ctx.fillStyle = cell ? this.foreground : this.background\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\t\t\tthis.ctx.setFillStyle(cell ? this.foreground : this.background)\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\tconst w = (Math.ceil((cdx + 1) * tileW) - Math.floor(cdx * tileW))\r\n\t\t\t\t\t\tconst h = (Math.ceil((rdx + 1) * tileH) - Math.floor(rdx * tileH))\r\n\t\t\t\t\t\tthis.ctx.fillRect(Math.round(cdx * tileW), Math.round(rdx * tileH), w, h)\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\tthis.ctx.draw()\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tdraw() {\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tif (!this.ctx) {\r\n\t\t\t\t\tthis.getContext(() => {\r\n\t\t\t\t\t\tthis.drawQrcode()\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.drawQrcode()\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\tthis.drawQrcode()\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tlongtap() {\r\n\t\t\t\tthis.$emit('longclick', {})\r\n\t\t\t},\r\n\t\t\ttouchstart() {\r\n\t\t\t\tthis.$emit('touchStart', {})\r\n\t\t\t},\r\n\t\t\ttouchend() {\r\n\t\t\t\tthis.$emit('touchEnd', {})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped></style>","import Component from 'D:/Projects/XBuider/校友会/xiaoyouhui-xiaochengxu/components/firstui/fui-qrcode/fui-qrcode.vue'\nwx.createComponent(Component)"],"names":["uni","fuiQr"],"mappings":"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"}