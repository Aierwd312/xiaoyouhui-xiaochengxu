{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["import store from '@/store'\r\nimport config from '@/config'\r\nimport { getToken } from '@/utils/auth'\r\nimport errorCode from '@/utils/errorCode'\r\nimport { toast, showConfirm, tansParams } from '@/utils/common'\r\n\r\nlet timeout = 10000\r\nconst baseUrl = config.baseUrl\r\n\r\nconst request = config => {\r\n  // 是否需要设置 token\r\n  const isToken = (config.headers || {}).isToken === false\r\n  config.header = config.header || {}\r\n  if (getToken() && !isToken) {\r\n    config.header['Authorization'] = 'Bearer ' + getToken()\r\n  }\r\n  // get请求映射params参数\r\n  if (config.params) {\r\n    let url = config.url + '?' + tansParams(config.params)\r\n    url = url.slice(0, -1)\r\n    config.url = url\r\n  }\r\n  return new Promise((resolve, reject) => {\r\n    uni.request({\r\n        method: config.method || 'get',\r\n        timeout: config.timeout ||  timeout,\r\n        url: config.baseUrl || baseUrl + config.url,\r\n        data: config.data,\r\n        header: config.header,\r\n        dataType: 'json'\r\n      }).then(response => {\r\n       /* let [error, res] = response\r\n        if (error) {\r\n          toast('后端接口连接异常')\r\n          reject('后端接口连接异常')\r\n          return\r\n        } */\r\n\t\tconst res=response\r\n        const code = res.data.code || 200\r\n        const msg = errorCode[code] || res.data.msg || errorCode['default']\r\n        if (code === 401) {\r\n          showConfirm('登录状态已过期，您可以继续留在该页面，或者重新登录?').then(res => {\r\n            if (res.confirm) {\r\n              store.dispatch('LogOut').then(res => {\r\n                uni.reLaunch({ url: '/pages/login' })\r\n              })\r\n            }\r\n          })\r\n          reject('无效的会话，或者会话已过期，请重新登录。')\r\n        } else if (code === 500) {\r\n          toast(msg)\r\n          reject('500')\r\n        } else if (code !== 200) {\r\n          toast(msg)\r\n          reject(code)\r\n        }\r\n        resolve(res.data)\r\n      })\r\n      .catch(error => {\r\n        let { message } = error\r\n        if (message === 'Network Error') {\r\n          message = '后端接口连接异常'\r\n        } else if (message.includes('timeout')) {\r\n          message = '系统接口请求超时'\r\n        } else if (message.includes('Request failed with status code')) {\r\n          message = '系统接口' + message.substr(message.length - 3) + '异常'\r\n        }\r\n        toast(message)\r\n        reject(error)\r\n      })\r\n  })\r\n}\r\n\r\nexport default request\r\n"],"names":["config","getToken","tansParams","uni","errorCode","showConfirm","res","store","toast"],"mappings":";;;;;;;AAMA,IAAI,UAAU;AACd,MAAM,UAAUA,OAAM,OAAC;AAElB,MAAC,UAAU,CAAAA,YAAU;AAExB,QAAM,WAAWA,QAAO,WAAW,CAAE,GAAE,YAAY;AACnD,EAAAA,QAAO,SAASA,QAAO,UAAU,CAAE;AACnC,MAAIC,WAAQ,SAAA,KAAM,CAAC,SAAS;AAC1B,IAAAD,QAAO,OAAO,eAAe,IAAI,YAAYC,WAAAA,SAAU;AAAA,EACxD;AAED,MAAID,QAAO,QAAQ;AACjB,QAAI,MAAMA,QAAO,MAAM,MAAME,aAAU,WAACF,QAAO,MAAM;AACrD,UAAM,IAAI,MAAM,GAAG,EAAE;AACrB,IAAAA,QAAO,MAAM;AAAA,EACd;AACD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCG,kBAAAA,MAAI,QAAQ;AAAA,MACR,QAAQH,QAAO,UAAU;AAAA,MACzB,SAASA,QAAO,WAAY;AAAA,MAC5B,KAAKA,QAAO,WAAW,UAAUA,QAAO;AAAA,MACxC,MAAMA,QAAO;AAAA,MACb,QAAQA,QAAO;AAAA,MACf,UAAU;AAAA,IAClB,CAAO,EAAE,KAAK,cAAY;AAOxB,YAAM,MAAI;AACJ,YAAM,OAAO,IAAI,KAAK,QAAQ;AAC9B,YAAM,MAAMI,gBAAS,UAAC,IAAI,KAAK,IAAI,KAAK,OAAOA,gBAAS,UAAC,SAAS;AAClE,UAAI,SAAS,KAAK;AAChBC,qBAAAA,YAAY,4BAA4B,EAAE,KAAK,CAAAC,SAAO;AACpD,cAAIA,KAAI,SAAS;AACfC,wBAAAA,MAAM,SAAS,QAAQ,EAAE,KAAK,CAAAD,SAAO;AACnCH,4BAAAA,MAAI,SAAS,EAAE,KAAK,eAAc,CAAE;AAAA,YACpD,CAAe;AAAA,UACF;AAAA,QACb,CAAW;AACD,eAAO,sBAAsB;AAAA,MACvC,WAAmB,SAAS,KAAK;AACvBK,qBAAAA,MAAM,GAAG;AACT,eAAO,KAAK;AAAA,MACtB,WAAmB,SAAS,KAAK;AACvBA,qBAAAA,MAAM,GAAG;AACT,eAAO,IAAI;AAAA,MACZ;AACD,cAAQ,IAAI,IAAI;AAAA,IACxB,CAAO,EACA,MAAM,WAAS;AACd,UAAI,EAAE,QAAO,IAAK;AAClB,UAAI,YAAY,iBAAiB;AAC/B,kBAAU;AAAA,MACX,WAAU,QAAQ,SAAS,SAAS,GAAG;AACtC,kBAAU;AAAA,MACX,WAAU,QAAQ,SAAS,iCAAiC,GAAG;AAC9D,kBAAU,SAAS,QAAQ,OAAO,QAAQ,SAAS,CAAC,IAAI;AAAA,MACzD;AACDA,mBAAAA,MAAM,OAAO;AACb,aAAO,KAAK;AAAA,IACpB,CAAO;AAAA,EACP,CAAG;AACH;;"}